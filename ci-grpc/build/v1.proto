syntax = "proto3";

option go_package = "build.rpc.v1";

message Request {
    // project name
    string name = 1;
    // event branch
    string branch = 2;
    // repository url
    string url = 3;
    // commit id
    string id = 4;
    // build language
    string language = 5;
    // default is "latest"
    string lanversion = 6;
    // is query the latest build job. Only use in query actions.
    bool latest = 7;
    // build owner
    string user = 8;
}

message Reply {
    // 0 - success
    // other - failed
    int32 code = 1;
    // Empty when success, otherwise there will be error message
    string message = 2;
}

message JobDetail {
    string name = 1;
    int32 status = 2;
    string timestamp = 3;
    string branch = 4;
    string url = 5;
}

message JobInfo {
    int32 count = 1;
    repeated JobDetail jd = 2;
}

// Builder will update status via this message.
message Builder {
    // The build job name
    string jname = 1;
    // The build job id
    string jid = 2;
    // Job Status
    int32 status = 3;
    // Job Owner
    string user = 4;
}

message Job {
    string name = 1;
}

message Log {
    string message = 1;
}

service BuildService {
    rpc Run (Request) returns (Reply) {
    }

    rpc Ping (Request) returns (Reply) {
    }

    rpc GetJob (Request) returns (JobInfo) {
    }

    // Builder update status via this rpc.
    rpc JobStatus (Builder) returns (Reply) {
    }

    rpc GetJobLog (Job) returns (stream Log) {
    }
}
